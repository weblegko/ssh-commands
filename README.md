# Команды SSH которые лучше знать :)
- [Архивы tar.gz & zip](#arch)
- [scp перенос файлов](#scp)
- [mysql экспорт, импорт](#db)
- [Работа с файлами](#files)
- [chmod](#chmod)

---------------------------------

## <a name="arch"></a> Архивы

Запаковать в tar.gz:  
tar -zcvf fdump.tar.gz folder/  
-c – значит, что создается новый архив;  
-f – посредством этого флага задается имя создаваемого архива;  
-z – архивация будет происходить посредством архиватора gzip;  
-v – в консоль будет выводиться информация о процессе архивации.  

####  Распаковать файлы из tar.gz через SSH:
tar -xzvf fdump.tar.gz
-x - распаковать архив

####  Запаковать файлы в zip:
zip -r fdump.zip folder/  
-r означает, что нужно искать файлы в папке рекурсивно, иначе в архиве бы оказалась одна пустая папка.

####  Распаковать файлы из zip:
unzip fdump.zip  

------------------------------------

## <a name="scp"></a> Переносим файлы через ssh

#### Скопировать локальный файл на сервер:  
scp fdump.zip root@server.my:/home/dir
  
#### Скопировать всё содержимое папки на сервере (рекурсивно) в локальную папку (с подробным выводом):  
scp -r root@server.my:/home/dir/ /home/local/my/

#### Между серверами:  
scp -r root@server1.my:/home/dir/ root@server2.my:/home/dir/

#### С указанием порта:  
scp -P 9999 fdump.zip user@server.my:~/

#### Дополнительные флаги:
-r - рекурсивное копирование (для директорий)  
-C - использовать сжатие при передачи  
-P - порт ssh (P большая! и -P указывает перед ssh хостом)  
-p - сохранить информацию о времени создания, модификации файла.  

Для передачи файлов часто бывает лучше использовать утилиту rsync.  

--------------------------------

## <a name="db"></a> Базы данных MySQL

####  Экспорт базы данных (создание дампа):  
mysqldump -u db_user -p -h localhost db_name > dump.sql  

#### Создание архива GZip с дампом БД:  
mysqldump -u db_user -p -h localhost db_name | gzip > dump.tar.gz

#### Создание дампа нескольких баз данных одновременно:  
mysqldump -u db_user -p -h localhost -B db_name1 db_name2 db_name3 > databases.sql

#### Создание дампа всех баз данных:  
mysqldump -u db_user -p -h localhost -A > all-databases.sql

#### Сохранить только структуру БД:  
''mysqldump --no-data -u db_user -p -h localhost db_name > schema.sql''

#### Создание дампа только одной или нескольких таблиц БД:  
mysqldump -u db_user -p -h localhost db_name tbl_name1 tbl_name2 tbl_name3 > dump.sql

Дополнительные атрибуты (уменьшают размер дампа и повышают скорость работы):  
mysqldump -Q -c -e -u db_user -p -h localhost db_name > /path/to/file/dump.sql

-Q - оборачивает имена обратными кавычками;  
-c - делает полную вставку, включая имена колонок;  
-e - делает расширенную вставку.  

------------------------------

####  Импорт дампа базы данных:  
mysql -u db_user -p -h localhost db_name < dump.sql

#### Импорт дампа базы данных, упакованных в gzip (*.sql.gz):  
gunzip < dump.sql.gz | mysql -u db_user -p db_name

------------------------------
## <a name="files"></a> Работа с файлами

#### Узнать абсолютный путь до текущего каталога:
pwd 

#### Перенос файлов:
mv ~/domains/site.com/temp/* ~/domains/site.kz/  
mv ~/domains/site.com/temp/.htaccess ~/domains/site.kz/  

#### Перенос всех скрытых файлов:
mv /home/user/path/.[!.]* ~/path/folder  
Важно указывать абсолютный путь до скрытых файлов, а в директорию куда переносим - необязательно.  

#### Копировать файлы:
cp -R ~/domains/sites.com/temp/* ~/domains/site.kz/  

#### Скопировать все скрытые файлы:
cp -p /home/user/path/.[!.]* ~/path/folder  

*Параметры:*  
-R - рекурсивно, т.е. скопировать все содержимое.  
-p - preserve, сохраняет время изменения, т.е. копирует файл полностью в оригинальном виде.  

#### Удалить папку со всем ее содержимым:
rm -R /path/to/folder

#### Подсчитать занимаемый размер каталога:
du -sh ./

#### Подсчитать занимаемый размер подпапок каталога:
du -sh ./*  
или du -h --max-depth=1 ./

#### Создать символьную ссылку:
ln -s  /etc/apache2/sites-available/site.com.conf /etc/apache2/sites-enabled/site.com.conf

-----------------------------
## <a name="chmod"></a> Назначать права доступа - chmod
Назначать права доступа на файлы или каталоги при помощи команды chmod можно двумя способами — при помощи символьного и абсолютных режимов.  

#### Примеры использования команды chmod в символьном режиме:

Изначальное значение прав доступа файла file —   rwxrwxrwx — полный доступ для всех  

Отмена разрешения на выполнение файла для всех пользователей и групп:  
$ chmod  a-x  file         (rw-rw-rw-)  

Отмена записи в файл группой и остальными пользователями:  
$ chmod  go-w  file      (rw-r—r—)  

Разрешение выполнения файла владельцем:  
$ chmod u+x file          (rwxr—r—)  

Предоставление группе тех прав доступа, которыми владеет владелец файла:  
$ chmod g=u file          (rwxrwxr—)  

Отмена чтения и запись в файл пользователям группы и другим пользователям:  
$ chmod go-rw file       (rwx—x—)  
 
#### Примеры использования команды chmod в абсолютном режиме:  

Разрешение чтения, записи, выполнения файла file всеми пользователями и группами (полный доступ):  
$ chmod 777 file        (rwxrwxrwx)

Права доступа 777 — это атрибуты файла или папки, которые указывают системе, кто и что может делать с данным файлом или папкой.  
В unix-системах, различные права доступа, можно назначать трем типам пользователей:  

владельцу файла,  
члену группы,  
всем остальным.  

Вышеуказанное число 777, состоящий из трех цифр, каждая из которых отвечает за права для каждого из типов пользователей.  

Права могут быть на чтение «R«, запись в папку или файл «W» и выполнения «X«.  

Так вот, численное представление прав доступа 777 представляет собой арифметическую сумму трех цифр, обозначающих следующие права:  

4 = Read (право на чтение - r)  
2 = Write (право на запись - w)  
1 = Execute (право на выполнение - x)  
В нашем случае 7 — это 4+2+1, то есть права на чтение, запись и исполнение. А 777 означает все права для всех, то есть чтение, запись и выполнение для владельца, члена группы и всех остальных.  


Установка разрешений на чтение и запись для владельца, группы и остальных пользователей:  
$ chmod 666 file        (rw-rw-rw-)  

Установка полного доступа к файлу для владельца и лишь чтения для группы и остальных пользователей:  
$ chmod 744 file        (rwxr—r—)  

Установка полного доступа к файлу владельцу файла и запрет доступа группе и другим пользователям:  
$ chmod 700 file        (rwx——)  

Установка разрешений на чтение и запись для владельца файла и лишь чтения для группы и остальных:
$ chmod 644 file        (rw-r—r—)  

Установка разрешений на чтение и запись владельцу файлу и его группе и запрет доступа для других:  
$ chmod 640 file        (rw-r——)  

Установка доступа к файлу с разрешением чтения для всех пользователей и групп:  
$ chmod 444 file        (r—r—r—)  

Права доступа к файлу для чтения, записи, выполнения владельцем и  чтения, выполнения группе и другим:  
$ chmod 755 file        (rwxr-xr-x)  

Разрешение доступа к файлу на чтение и выполнение пользователю и остальным и запрет доступа  для группы:  
$ chmod 505 file        (r-x—r-x)  
 
Если вы хотите назначить права доступа на все файлы в текущем каталоге, просто поставьте после назначаемых прав доступа знак * (звездочка):  
$ chmod 755 *  
В результате выполнения этой команды владелец получит полные права (чтение, изменение, выполнение) на все файлы текущего каталога, а группа и другие пользователи — только чтение и выполнение.  

Если вы хотите, чтобы ваши действия распространились рекурсивно (включая все подкаталоги), воспользуйтесь опцией -R:  
$ chmod -R 777 *  
Результатом выполнения вышеприведенной команды будет рекурсивный «обход» всех подкаталогов текущего каталога и назначение полного доступа для всех пользователей и групп.



#To change all the directories to 755 (drwxr-xr-x):  
find . -type d -exec chmod 0755 {} \;

#To change all the files to 644 (-rw-r--r--):  
find . -type f -exec chmod 0644 {} \;

You can be even more controlling with other options, such as:

find . -type d -user harry -exec chown daisy {} \;





## Изменить владельца и/или группу - chown

#### Cменить владельца (пользователя) файла

sudo chown userName text.txt
В данном примере мы присвоили файл text.txt пользователю userName.

#### Поменять только группу -  chgrp

sudo chgrp groupName text.txt

Для того чтобы не вводить 2 разные команды делают так:

sudo chown userName:groupName text.txt

Вначале указывается владелец файла, а после группа

Если вам нужно поменять в директории владельца и группу, а там множество файлов и папок тогда используйте ключ -R:

sudo chown -R userName:groupName /var/www/site/


------------------------------------------------------------
## Узнать размеры каталогов 
du -hc dirname/
### Один уровень вложенности выводить и отсортировать по убыванию
du --max-depth=1 -hc  | sort -n -r

## Узнать как использован диск
df -h


